{% extends 'base.html' %}
{% load static %}
{% load mathfilters %}

{% block head %}
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="row g-3">
    <!-- Ï¢åÏ∏° ÏÑúÎ≤Ñ/Ïª®ÌÖåÏù¥ÎÑà Ïπ¥Îìú -->
    <div class="col-sm-8">
      <div class="label-card h-100">
        <div class="card-body p-3 overflow-auto">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="m-0">127.0.0.2</h4>
            <div class="dropdown">
              <button class="hit-btn-outline-dark dropdown-toggle" 
                      type="button" 
                      id="serverDropdown" 
                      data-bs-toggle="dropdown" 
                      aria-expanded="false">
                Server List
              </button>
              <ul class="dropdown-menu" aria-labelledby="serverDropdown">
                <li><a class="dropdown-item" href="#">127.0.0.1</a></li>
                <li><a class="dropdown-item" href="#">localhost</a></li>
                <li><a class="dropdown-item" href="#">None</a></li>
              </ul>
            </div>
          </div>
          <table class="manager-table w-100">
            <thead>
              <tr>
                <th>#</th>
                <th>CONTAINER ID</th>
                <th>IMAGE</th>
                <th>STATUS</th>
                <th>CREATED</th>
                <th>NAMES</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1</td>
                <td>1d2bcd83ab69</td>
                <td>cd484474f5fe</td>
                <td>Up 2 days</td>
                <td>2 days ago</td>
                <td>test</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Ïö∞Ï∏° Ïª§Ïä§ÌÖÄ Í∏∞Îä• Ïπ¥Îìú -->
    <div class="col-sm-4">
      <div class="label-card h-100">
        <div class="card-body p-3 overflow-auto">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="m-0">127.0.0.2</h4>
            <div class="dropdown">
              <button class="hit-btn-outline-dark dropdown-toggle" 
                      type="button" 
                      id="featureDropdown" 
                      data-bs-toggle="dropdown" 
                      aria-expanded="false">
                Options
              </button>
              <ul class="dropdown-menu" aria-labelledby="featureDropdown">
                <li><a class="dropdown-item" href="#">Ïñ¥Îñ§</a></li>
                <li><a class="dropdown-item" href="#">Í∏∞Îä•ÏùÑ</a></li>
                <li><a class="dropdown-item" href="#">ÎÑ£ÏùÑÍπåÏöî~</a></li>
              </ul>
            </div>
          </div>
          <table class="manager-table w-100">
            <thead>
              <tr>
                <th>#</th>
                <th>Î¨¥</th>
                <th>Ïóá</th>
                <th>ÏùÑ</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1</td>
                <td>ÎÑ£</td>
                <td>ÏùÑ</td>
                <td>Íπå</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3 mt-3">
    <!-- ÎîîÏä§ÌÅ¨ ÏÇ¨Ïö©Îüâ -->
    <div class="col-md-6">
      <h4>üìä Disk Usage Overview</h4>
      <div class="label-card p-3" style="height:30vh;">
        <div class="mb-3">
          <div class="d-flex justify-content-between">
            <strong>/tmp</strong>
            <span>5%</span>
          </div>
          <div class="progress" style="height:25px;">
            <div class="progress-bar bg-success"
                 role="progressbar"
                 style="width:20%;"
                 aria-valuenow="20"
                 aria-valuemin="0"
                 aria-valuemax="100">
              31G / 63G
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- GPU ÏÇ¨Ïö©Îüâ Ï∞®Ìä∏ -->
    <div class="col-md-6">
      <h4 class="text-center">üñ•Ô∏è GPU ÏÇ¨Ïö©Îüâ</h4>
      <div class="label-card p-3" style="height:30vh;">
        <canvas id="gpu-usage" style="width:100%; height:100%;"></canvas>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
<script src="{% static 'chart.js' %}"></script>
<script>
fetch('/server_dashboard/gpu_info/')
  .then(res => res.json())
  .then(chartData => {
    new Chart(document.getElementById('gpu-usage'), {
      type: 'bar',
      data: {
        labels: chartData.labels,
        datasets: [{
          label: 'GPU Usage (%)',
          data: chartData.data,
          backgroundColor: chartData.backgroundColors,
          borderColor: chartData.backgroundColors.map(c => c.replace('0.2','1')),
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            ticks: { stepSize: 10, callback: v=>v+'%' }
          }
        }
      }
    });
  });
</script>
{% endblock %}
