{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="container my-4">
    <h4 class="mb-3 border-bottom pb-2">새 모델 등록</h4>

    <form id="modelForm" method="post" novalidate>
        {% csrf_token %}

        <!-- 모델 정보 카드 -->
        <div class="card mb-4">
            <div class="card-header"><strong>모델 정보</strong></div>
            <div class="card-body">
                <div class="row gx-3">
                    <!-- 모델 이름 -->
                    <div class="col-md-6 mb-3">
                        <label for="name" class="form-label">모델 이름<span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="name" name="name"
                            value="{{ form.name.value|default_if_none:'' }}" required>
                        <div class="invalid-feedback">모델 이름을 입력해주세요.</div>
                    </div>

                    <!-- Task Type: 자유 입력 -->
                    <div class="col-md-6 mb-3">
                        <label for="task_type" class="form-label">Task Type<span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="task_type" name="task_type"
                            placeholder="예: LLM, PLM, DPO, GEN 등" value="{{ form.task_type.value|default_if_none:'' }}"
                            required>
                        <div class="invalid-feedback">Task Type을 입력해주세요.</div>
                    </div>

                    <!-- 태그: Tagify -->
                    <div class="col-md-6 mb-3">
                        <label for="tag-input" class="form-label">태그</label>
                        <input type="text" class="form-control" id="tag-input" name="tag" placeholder="쉼표로 구분된 태그 입력"
                            value="{{ form.tag.value|default_if_none:''|escape }}">
                        <small class="form-text text-muted">예: ai, vision, nlp</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- 파일 시스템 뷰어 카드 (항상 보임) -->
        <div class="card mb-4">
            <div class="card-header"><strong>파일 시스템 뷰어</strong></div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="weight_path" class="form-label">모델 경로 (README.md가 있는 폴더)</label>
                    <input type="text" class="form-control" id="weight_path" name="weight_path"
                        value="{{ path|default_if_none:'' }}" readonly>
                </div>

                {% include "partials/file_system_viewr.html" %}
            </div>
        </div>

        <!-- 제출 버튼 -->
        <div class="mb-3 text-center">
            <button type="submit" name="save" class="btn btn-info me-2">저장</button>
            <a href="{% url 'models:index' %}" class="btn btn-danger">취소</a>
        </div>
    </form>
</div>

{# Tagify only #}
<link rel="stylesheet" href="{% static 'tagify/tagify.css' %}">
<script src="{% static 'tagify/tagify.js' %}"></script>

<script>
    // Tagify 초기화
    document.addEventListener('DOMContentLoaded', () => {
        var input = document.getElementById('tag-input');
        if (input) {
            new Tagify(input, {
                delimiters: ",",
                dropdown: {
                    enabled: 0   // 자동 완성 드롭다운 비활성화
                }
            });
        }
    });

    // Bootstrap 실시간 검증
    (function () {
        'use strict';
        var form = document.getElementById('modelForm');
        form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });

    ['name', 'task_type'].forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            el.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    // 필요하면 여기에 포커스를 다음 필드로 이동하는 로직 추가 가능
                }
            });
        });

</script>


{% endblock %}